
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://arminshzd.github.io/GADES/reference/GADES/">
      
      
        <link rel="prev" href="../../examples/sulf/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../imgs/GADES_favicon_b.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>GADES - GADES</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gadespy-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="GADES" class="md-header__button md-logo" aria-label="GADES" data-md-component="logo">
      
  <img src="../../imgs/GADES_favicon_b.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GADES
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GADES
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/arminshzd/GADES" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="GADES" class="md-nav__button md-logo" aria-label="GADES" data-md-component="logo">
      
  <img src="../../imgs/GADES_favicon_b.png" alt="logo">

    </a>
    GADES
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/arminshzd/GADES" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../examples/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/MB_pot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Müller-Brown
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/AIB9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AIB9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/sulf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sulfadiazine
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    GADES
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    GADES
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#GADES" class="md-nav__link">
    <span class="md-ellipsis">
      GADES
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#GADES.GADESForceUpdater" class="md-nav__link">
    <span class="md-ellipsis">
      GADESForceUpdater
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GADESForceUpdater">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#GADES.GADESForceUpdater.set_kappa" class="md-nav__link">
    <span class="md-ellipsis">
      set_kappa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#GADES.GADESForceUpdater.set_hess_step_size" class="md-nav__link">
    <span class="md-ellipsis">
      set_hess_step_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#GADES.GADESForceUpdater.describeNextReport" class="md-nav__link">
    <span class="md-ellipsis">
      describeNextReport
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#GADES.GADESForceUpdater.report" class="md-nav__link">
    <span class="md-ellipsis">
      report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#GADES.getGADESBiasForce" class="md-nav__link">
    <span class="md-ellipsis">
      getGADESBiasForce
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="gadespy-api-reference"><code>GADES.py</code> API reference</h1>


<div class="doc doc-object doc-module">



<a id="GADES"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="GADES.GADESForceUpdater" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GADESForceUpdater</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">GADESForceUpdater</span><span class="p">(</span><span class="n">biased_force</span><span class="p">,</span> <span class="n">bias_atom_indices</span><span class="p">,</span> <span class="n">hess_func</span><span class="p">,</span> <span class="n">clamp_magnitude</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">stability_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logfile_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Initialize a GADESForceUpdater for applying Gentlest Ascent Dynamics (GADES) bias forces.</p>
<p>The updater identifies the softest Hessian eigenmode of the system and constructs
a directional bias force along that mode using:
$$
F_{\text{GADES}} = - \kappa \, (\mathbf{F}_{\text{system}} \cdot \vec{n}) \, \vec{n},
$$</p>
<p>where <span class="arithmatex">\(\vec{n}\)</span> is normalized eigenvector corresponding to the softest mode.
the The bias is applied to a specified set of atoms at regular intervals,
with optional stability checks and logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>biased_force</code>
            </td>
            <td>
                  <code><span title="openmm.CustomExternalForce">CustomExternalForce</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The OpenMM force object that will receive GADES bias forces.
Must be created using <code>getGADESBiasForce()</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bias_atom_indices</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of atoms that should receive the bias force.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hess_func</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A user-supplied function returning the Hessian matrix for the system.
Must accept <code>(system, positions, atom_indices, step_size, platform)</code>
as input and return a 2D array-like Hessian. Choose one of 
<code>GADES.utils.compute_hessian_force_fd_richardson</code>, 
<code>GADES.utils.compute_hessian_force_fd_block_serial</code>, or
<code>GADES.utils.compute_hessian_force_fd_block_parallel</code>. We suggest
the Richardson variant.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clamp_magnitude</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowed magnitude for each component of the bias force,
used to prevent unphysical updates or exploration of irrelavant
regions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scaling factor (0 &lt; κ &lt; 1) applied to the bias force along the
softest eigenmode. GADES is designed for exploration applications
with κ=0.9. Values larger than 1 will lead to the system lingering
in the transition regions. Values smaller than 0.9 limit the
maximum gradient GADES is able to overcome. We suggest controling
this with <code>clamp_magnitude</code> instead of <code>kappa</code> since <code>kappa</code> will
damp <strong>all</strong> forces while the clamp is only effective in high-
gradient regions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of simulation steps between bias force updates. Values
less than 100 are overridden to 110 internally to ensure stability.
Smaller values make for a more accurate bias direction, at the 
expense of computational cost. In our experience, a value of 
~2000 is a good place to start.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stability_interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps between stability checks based on kinetic
temperature. If None, only post-bias stability checks are used.
This check ensures that the system doesn't stray too far from 
the set temperature by turning the bias off if the temperature
rises &gt;50 K of the simulation temeprature. We suggest a value of
500 steps for most simulations.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logfile_prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix for log files. If provided, the following files are created:
  - <code>&lt;prefix&gt;_evec.log</code>: trajectory of softest-mode eigenvectors
  - <code>&lt;prefix&gt;_eval.log</code>: trajectory of  sorted eigenvalue spectra
  - <code>&lt;prefix&gt;_biased_atoms.xyz</code>: biased atom trajectories in XYZ format</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>interval</code> is not a positive integer.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="OSError">OSError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If log files cannot be created when <code>logfile_prefix</code> is set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">GADES</span><span class="w"> </span><span class="kn">import</span> <span class="n">getGADESBiasForce</span><span class="p">,</span> <span class="n">GADESForceUpdater</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">GADES.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_hessian_force_fd_richardson</span> <span class="k">as</span> <span class="n">hessian</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simulation</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">biasing_atom_ids</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">GAD_force</span> <span class="o">=</span> <span class="n">getGADESBiasForce</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">GADESupdater</span> <span class="o">=</span> <span class="n">GADESForceUpdater</span><span class="p">(</span>
<span class="go">                    biased_force=GAD_force, </span>
<span class="go">                    bias_atom_indices=biasing_atom_ids,</span>
<span class="go">                    hess_func=hessian, </span>
<span class="go">                    clamp_magnitude=2500,</span>
<span class="go">                    kappa=0.9, </span>
<span class="go">                    interval=1000, </span>
<span class="go">                    stability_interval=500, </span>
<span class="go">                    logfile_prefix=&quot;GADES_log&quot;</span>
<span class="go">                    )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GADESupdater</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</code></pre></div>








                  <details class="quote">
                    <summary>Source code in <code>GADES/gades.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">biased_force</span><span class="p">:</span> <span class="n">CustomExternalForce</span><span class="p">,</span>
    <span class="n">bias_atom_indices</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">hess_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">clamp_magnitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">stability_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logfile_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a GADESForceUpdater for applying Gentlest Ascent Dynamics (GADES) bias forces.</span>

<span class="sd">    The updater identifies the softest Hessian eigenmode of the system and constructs</span>
<span class="sd">    a directional bias force along that mode using:</span>
<span class="sd">    $$</span>
<span class="sd">    F_{\text{GADES}} = - \kappa \, (\mathbf{F}_{\text{system}} \cdot \vec{n}) \, \vec{n},</span>
<span class="sd">    $$</span>

<span class="sd">    where $\vec{n}$ is normalized eigenvector corresponding to the softest mode.</span>
<span class="sd">    the The bias is applied to a specified set of atoms at regular intervals,</span>
<span class="sd">    with optional stability checks and logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        biased_force (openmm.CustomExternalForce):</span>
<span class="sd">            The OpenMM force object that will receive GADES bias forces.</span>
<span class="sd">            Must be created using `getGADESBiasForce()`.</span>
<span class="sd">        bias_atom_indices (Sequence[int]):</span>
<span class="sd">            Indices of atoms that should receive the bias force.</span>
<span class="sd">        hess_func (Callable):</span>
<span class="sd">            A user-supplied function returning the Hessian matrix for the system.</span>
<span class="sd">            Must accept `(system, positions, atom_indices, step_size, platform)`</span>
<span class="sd">            as input and return a 2D array-like Hessian. Choose one of </span>
<span class="sd">            `GADES.utils.compute_hessian_force_fd_richardson`, </span>
<span class="sd">            `GADES.utils.compute_hessian_force_fd_block_serial`, or</span>
<span class="sd">            `GADES.utils.compute_hessian_force_fd_block_parallel`. We suggest</span>
<span class="sd">            the Richardson variant.</span>
<span class="sd">        clamp_magnitude (float):</span>
<span class="sd">            Maximum allowed magnitude for each component of the bias force,</span>
<span class="sd">            used to prevent unphysical updates or exploration of irrelavant</span>
<span class="sd">            regions.</span>
<span class="sd">        kappa (float):</span>
<span class="sd">            Scaling factor (0 &lt; κ &lt; 1) applied to the bias force along the</span>
<span class="sd">            softest eigenmode. GADES is designed for exploration applications</span>
<span class="sd">            with κ=0.9. Values larger than 1 will lead to the system lingering</span>
<span class="sd">            in the transition regions. Values smaller than 0.9 limit the</span>
<span class="sd">            maximum gradient GADES is able to overcome. We suggest controling</span>
<span class="sd">            this with `clamp_magnitude` instead of `kappa` since `kappa` will</span>
<span class="sd">            damp __all__ forces while the clamp is only effective in high-</span>
<span class="sd">            gradient regions.</span>
<span class="sd">        interval (int):</span>
<span class="sd">            Number of simulation steps between bias force updates. Values</span>
<span class="sd">            less than 100 are overridden to 110 internally to ensure stability.</span>
<span class="sd">            Smaller values make for a more accurate bias direction, at the </span>
<span class="sd">            expense of computational cost. In our experience, a value of </span>
<span class="sd">            ~2000 is a good place to start.</span>
<span class="sd">        stability_interval (int, optional):</span>
<span class="sd">            Number of steps between stability checks based on kinetic</span>
<span class="sd">            temperature. If None, only post-bias stability checks are used.</span>
<span class="sd">            This check ensures that the system doesn&#39;t stray too far from </span>
<span class="sd">            the set temperature by turning the bias off if the temperature</span>
<span class="sd">            rises &gt;50 K of the simulation temeprature. We suggest a value of</span>
<span class="sd">            500 steps for most simulations.</span>
<span class="sd">        logfile_prefix (str, optional):</span>
<span class="sd">            Prefix for log files. If provided, the following files are created:</span>
<span class="sd">              - `&lt;prefix&gt;_evec.log`: trajectory of softest-mode eigenvectors</span>
<span class="sd">              - `&lt;prefix&gt;_eval.log`: trajectory of  sorted eigenvalue spectra</span>
<span class="sd">              - `&lt;prefix&gt;_biased_atoms.xyz`: biased atom trajectories in XYZ format</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `interval` is not a positive integer.</span>
<span class="sd">        OSError: If log files cannot be created when `logfile_prefix` is set.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from GADES import getGADESBiasForce, GADESForceUpdater</span>
<span class="sd">        &gt;&gt;&gt; from GADES.utils import compute_hessian_force_fd_richardson as hessian</span>
<span class="sd">        &gt;&gt;&gt; system = ...</span>
<span class="sd">        &gt;&gt;&gt; simulation = ...</span>
<span class="sd">        &gt;&gt;&gt; biasing_atom_ids = ...</span>
<span class="sd">        &gt;&gt;&gt; GAD_force = getGADESBiasForce(system.getNumParticles())</span>
<span class="sd">        &gt;&gt;&gt; GADESupdater = GADESForceUpdater(</span>
<span class="sd">                            biased_force=GAD_force, </span>
<span class="sd">                            bias_atom_indices=biasing_atom_ids,</span>
<span class="sd">                            hess_func=hessian, </span>
<span class="sd">                            clamp_magnitude=2500,</span>
<span class="sd">                            kappa=0.9, </span>
<span class="sd">                            interval=1000, </span>
<span class="sd">                            stability_interval=500, </span>
<span class="sd">                            logfile_prefix=&quot;GADES_log&quot;</span>
<span class="sd">                            )</span>
<span class="sd">        &gt;&gt;&gt; simulation.reporters.append(GADESupdater)</span>
<span class="sd">        &gt;&gt;&gt; simulation.step(10000)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">biased_force</span> <span class="o">=</span> <span class="n">biased_force</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bias_atom_indices</span> <span class="o">=</span> <span class="n">bias_atom_indices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hess_func</span> <span class="o">=</span> <span class="n">hess_func</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clamp_magnitude</span> <span class="o">=</span> <span class="n">clamp_magnitude</span>
    <span class="k">if</span> <span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;33m[GADES| WARNING] Bias update interval must be larger than 100 steps to ensure system stability. Changing the frequency to 110 steps internally...</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">110</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">kappa</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hess_step_size</span> <span class="o">=</span> <span class="mf">1e-5</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_stability</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_biasing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s_interval</span> <span class="o">=</span> <span class="n">stability_interval</span>

    <span class="c1"># post bias update check</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atom_symbols</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logfile_prefix</span> <span class="o">=</span> <span class="n">logfile_prefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_evec_log</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_log</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xyz_log</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">logfile_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># register with atexit for safe handling of log files</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_close_logs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_evec_log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logfile_prefix</span><span class="si">}</span><span class="s2">_evec.log&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evec_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Softest-mode eigenvector at each step (one per line)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evec_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Columns: step, eigenvector components (flattened)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evec_log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logfile_prefix</span><span class="si">}</span><span class="s2">_eval.log&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Sorted eigenvalue spectrum at each step (one line per frame)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Columns: step, eigenvalues from smallest to largest</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz_log</span>  <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logfile_prefix</span><span class="si">}</span><span class="s2">_biased_atoms.xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Trajectory of biased atoms only</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Each frame follows XYZ format: N_atoms, comment, atom lines</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Coordinates are in nanometers; atoms are labeled &#39;C&#39; by default</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xyz_log</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="GADES.GADESForceUpdater.set_kappa" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_kappa</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update the scaling factor κ used for the GADES bias force.</p>
<p>This method is the setter of <code>kappa</code>, which determines how strongly
the bias is applied along the softest Hessian eigenmode. The new value
will be used in all subsequent bias updates. Note that there are no checks
on the provided value for <code>kappa</code> for maximum flexibility. However, 
GADES is designed for exploration applications with 0 &lt; κ &lt; 1. Stability
and behavior has not been tested for κ outside this range. Values larger
than 1 will lead to the system lingering in the transition regions. 
Values smaller than 0.9 limit the maximum gradient GADES is able to 
overcome. We suggest controling this with <code>clamp_magnitude</code> instead of 
<code>kappa</code> since <code>kappa</code> will damp <strong>all</strong> forces while the clamp is only 
effective in high-gradient regions. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New scaling factor κ for the bias force.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">GADESupdater</span><span class="o">.</span><span class="n">set_kappa</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">updater</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span>
<span class="go">0.8</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>GADES/gades.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_kappa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the scaling factor κ used for the GADES bias force.</span>

<span class="sd">    This method is the setter of `kappa`, which determines how strongly</span>
<span class="sd">    the bias is applied along the softest Hessian eigenmode. The new value</span>
<span class="sd">    will be used in all subsequent bias updates. Note that there are no checks</span>
<span class="sd">    on the provided value for `kappa` for maximum flexibility. However, </span>
<span class="sd">    GADES is designed for exploration applications with 0 &lt; κ &lt; 1. Stability</span>
<span class="sd">    and behavior has not been tested for κ outside this range. Values larger</span>
<span class="sd">    than 1 will lead to the system lingering in the transition regions. </span>
<span class="sd">    Values smaller than 0.9 limit the maximum gradient GADES is able to </span>
<span class="sd">    overcome. We suggest controling this with `clamp_magnitude` instead of </span>
<span class="sd">    `kappa` since `kappa` will damp __all__ forces while the clamp is only </span>
<span class="sd">    effective in high-gradient regions. </span>

<span class="sd">    Args:</span>
<span class="sd">        kappa (float):</span>
<span class="sd">            New scaling factor κ for the bias force.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; GADESupdater.set_kappa(0.8)</span>
<span class="sd">        &gt;&gt;&gt; print(updater.kappa)</span>
<span class="sd">        0.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">kappa</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="GADES.GADESForceUpdater.set_hess_step_size" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_hess_step_size</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_hess_step_size</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update the displacement step size used for numerical Hessian calculations.</p>
<p>The Hessian is computed via finite-difference displacements of the
atomic coordinates. This method updates the step size <code>delta</code> used in
those displacements, which can affect both accuracy and numerical stability.
The Richardson method-based Hessian calculators are less prone to 
numerical errors due to small/large step sizes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>delta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New displacement step size (in nanometers) for Hessian evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>delta</code> is not positive.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">GADESupdater</span><span class="o">.</span><span class="n">set_hess_step_size</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">updater</span><span class="o">.</span><span class="n">hess_step_size</span><span class="p">)</span>
<span class="go">0.0001</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>GADES/gades.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_hess_step_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the displacement step size used for numerical Hessian calculations.</span>

<span class="sd">    The Hessian is computed via finite-difference displacements of the</span>
<span class="sd">    atomic coordinates. This method updates the step size `delta` used in</span>
<span class="sd">    those displacements, which can affect both accuracy and numerical stability.</span>
<span class="sd">    The Richardson method-based Hessian calculators are less prone to </span>
<span class="sd">    numerical errors due to small/large step sizes.</span>

<span class="sd">    Args:</span>
<span class="sd">        delta (float):</span>
<span class="sd">            New displacement step size (in nanometers) for Hessian evaluation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `delta` is not positive.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; GADESupdater.set_hess_step_size(1e-4)</span>
<span class="sd">        &gt;&gt;&gt; print(updater.hess_step_size)</span>
<span class="sd">        0.0001</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hessian step size `delta` cannot be zero or negative.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hess_step_size</span> <span class="o">=</span> <span class="n">delta</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="GADES.GADESForceUpdater.describeNextReport" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">describeNextReport</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">describeNextReport</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Define when the reporter should run next and what data it requires.</p>
<p>This method is required by the OpenMM <code>Reporter</code> interface and must be
implemented in all reporter subclasses. It determines how many steps
until the next reporting event and specifies which data types (positions,
velocities, forces, energies, volumes) are needed at that time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="openmm.app.Simulation">Simulation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The OpenMM Simulation object providing the current step and state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="bool">bool</span>, <span title="bool">bool</span>, <span title="bool">bool</span>, <span title="bool">bool</span>, <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 6-element tuple with the following contents:
  - steps (int): Number of steps until the next report.
  - needsPositions (bool): Always False.
  - needsVelocities (bool): Always False.
  - needsForces (bool): Always False.
  - needsEnergy (bool): Always False.
  - needsVolume (bool): Always False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Even though this method is not part of the intended public API for
  <code>GADESForceUpdater</code>, it must remain public (no leading underscore)
  because OpenMM requires <code>describeNextReport</code> to be defined.</li>
<li>Internally, this method:<ul>
<li>Ensures atom symbols are initialized for logging.</li>
<li>Schedules the next bias update, stability check, or post-bias check.</li>
<li>Sets internal flags (<code>is_biasing</code>, <code>check_stability</code>) for use in
  subsequent reporting steps.</li>
</ul>
</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>GADES/gades.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">describeNextReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">:</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define when the reporter should run next and what data it requires.</span>

<span class="sd">    This method is required by the OpenMM `Reporter` interface and must be</span>
<span class="sd">    implemented in all reporter subclasses. It determines how many steps</span>
<span class="sd">    until the next reporting event and specifies which data types (positions,</span>
<span class="sd">    velocities, forces, energies, volumes) are needed at that time.</span>

<span class="sd">    Args:</span>
<span class="sd">        simulation (openmm.app.Simulation):</span>
<span class="sd">            The OpenMM Simulation object providing the current step and state.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple:</span>
<span class="sd">            A 6-element tuple with the following contents:</span>
<span class="sd">              - steps (int): Number of steps until the next report.</span>
<span class="sd">              - needsPositions (bool): Always False.</span>
<span class="sd">              - needsVelocities (bool): Always False.</span>
<span class="sd">              - needsForces (bool): Always False.</span>
<span class="sd">              - needsEnergy (bool): Always False.</span>
<span class="sd">              - needsVolume (bool): Always False.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Even though this method is not part of the intended public API for</span>
<span class="sd">          `GADESForceUpdater`, it must remain public (no leading underscore)</span>
<span class="sd">          because OpenMM requires `describeNextReport` to be defined.</span>
<span class="sd">        - Internally, this method:</span>
<span class="sd">            * Ensures atom symbols are initialized for logging.</span>
<span class="sd">            * Schedules the next bias update, stability check, or post-bias check.</span>
<span class="sd">            * Sets internal flags (`is_biasing`, `check_stability`) for use in</span>
<span class="sd">              subsequent reporting steps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">currentStep</span>

    <span class="c1"># Extract atom symbols on the first call for logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_atom_symbols</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

    <span class="c1"># Compute time to each type of report</span>
    <span class="n">steps_to_check</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_interval</span> <span class="o">-</span> <span class="n">step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_interval</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_interval</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="p">)</span>
    <span class="n">steps_to_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">-</span> <span class="n">step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">steps_to_postbias</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span> <span class="o">-</span> <span class="n">step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">steps_to_postbias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Choose the next event</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">steps_to_bias</span><span class="p">,</span> <span class="n">steps_to_check</span><span class="p">,</span> <span class="n">steps_to_postbias</span><span class="p">)</span>

    <span class="c1"># Set flags *before* return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_biasing</span> <span class="o">=</span> <span class="p">(</span><span class="n">steps</span> <span class="o">==</span> <span class="n">steps_to_bias</span><span class="p">)</span>
    <span class="n">is_forced_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">steps</span> <span class="o">==</span> <span class="n">steps_to_postbias</span><span class="p">)</span>
    <span class="n">is_regular_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">steps</span> <span class="o">==</span> <span class="n">steps_to_check</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_stability</span> <span class="o">=</span> <span class="n">is_forced_check</span> <span class="ow">or</span> <span class="n">is_regular_check</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="GADES.GADESForceUpdater.report" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">report</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">report</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply (or remove) GADES bias forces at the current simulation step.</p>
<p>This method fulfills the OpenMM <code>Reporter</code> interface requirement. It uses
internal scheduling flags set by <code>describeNextReport</code> to decide whether to:
  1) perform a stability check and remove bias if unstable,
  2) update/apply the GADES bias forces, or
  3) do nothing this step.
Parameter updates are pushed to the OpenMM context when modifications occur.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="openmm.app.Simulation">Simulation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The OpenMM Simulation object (provides context, step counter, etc.).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="openmm.State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current simulation state. Unused here, but required by the Reporter API.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="side-effects" open>
  <summary>Side Effects</summary>
  <ul>
<li>Calls <code>_get_gad_force</code> to compute biased forces when <code>is_biasing</code> is True.</li>
<li>Updates <code>self.biased_force</code> per-atom parameters and pushes them with
  <code>updateParametersInContext(simulation.context)</code>.</li>
<li>Clears or sets scheduling flags:<ul>
<li><code>self.check_stability</code> → False after a stability-handling step.</li>
<li><code>self.is_biasing</code> → False after bias has been applied.</li>
<li><code>self.next_postbias_check_step</code> → set to <code>step + 100</code> after applying bias,
  or cleared when the scheduled post-bias check is reached.</li>
</ul>
</li>
<li>Emits informational messages to stdout about actions taken.</li>
</ul>
</details>

<details class="internal-helpers" open>
  <summary>Internal Helpers</summary>
  <ul>
<li><code>remove_bias()</code> (internal use only):
    Reset the per-atom bias parameters to <code>(0.0, 0.0, 0.0)</code> for all
    <code>bias_atom_indices</code>, effectively disabling the bias.</li>
<li><code>apply_bias()</code> (internal use only):
    Compute the current GADES bias via <code>_get_gad_force(simulation)</code> and set
    per-atom parameters accordingly for all <code>bias_atom_indices</code>.</li>
</ul>
</details>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This method is typically triggered by OpenMM according to the schedule
  returned by <code>describeNextReport</code>. It defensively calls
  <code>_ensure_atom_symbols(simulation)</code> in case the reporter was invoked
  before <code>describeNextReport</code>.</li>
<li>If <code>self.check_stability</code> is True, the method first evaluates stability via
  <code>_is_stable(simulation)</code>:<ul>
<li>If unstable (ΔT &gt; 50 K from target), the bias is removed for safety.</li>
<li>If stable and <code>self.is_biasing</code> is True, the bias is (re)applied and a
  post-bias check is scheduled in 100 steps.</li>
</ul>
</li>
<li>If neither <code>self.check_stability</code> nor <code>self.is_biasing</code> is set, the method
  performs no action for the current step.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>GADES/gades.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">:</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">,</span> 
           <span class="n">state</span><span class="p">:</span> <span class="n">openmm</span><span class="o">.</span><span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply (or remove) GADES bias forces at the current simulation step.</span>

<span class="sd">    This method fulfills the OpenMM `Reporter` interface requirement. It uses</span>
<span class="sd">    internal scheduling flags set by `describeNextReport` to decide whether to:</span>
<span class="sd">      1) perform a stability check and remove bias if unstable,</span>
<span class="sd">      2) update/apply the GADES bias forces, or</span>
<span class="sd">      3) do nothing this step.</span>
<span class="sd">    Parameter updates are pushed to the OpenMM context when modifications occur.</span>

<span class="sd">    Args:</span>
<span class="sd">        simulation (openmm.app.Simulation):</span>
<span class="sd">            The OpenMM Simulation object (provides context, step counter, etc.).</span>
<span class="sd">        state (openmm.State):</span>
<span class="sd">            Current simulation state. Unused here, but required by the Reporter API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Side Effects:</span>
<span class="sd">        - Calls `_get_gad_force` to compute biased forces when `is_biasing` is True.</span>
<span class="sd">        - Updates `self.biased_force` per-atom parameters and pushes them with</span>
<span class="sd">          `updateParametersInContext(simulation.context)`.</span>
<span class="sd">        - Clears or sets scheduling flags:</span>
<span class="sd">            * `self.check_stability` → False after a stability-handling step.</span>
<span class="sd">            * `self.is_biasing` → False after bias has been applied.</span>
<span class="sd">            * `self.next_postbias_check_step` → set to `step + 100` after applying bias,</span>
<span class="sd">              or cleared when the scheduled post-bias check is reached.</span>
<span class="sd">        - Emits informational messages to stdout about actions taken.</span>

<span class="sd">    Internal Helpers:</span>
<span class="sd">        - `remove_bias()` (internal use only):</span>
<span class="sd">            Reset the per-atom bias parameters to `(0.0, 0.0, 0.0)` for all</span>
<span class="sd">            `bias_atom_indices`, effectively disabling the bias.</span>
<span class="sd">        - `apply_bias()` (internal use only):</span>
<span class="sd">            Compute the current GADES bias via `_get_gad_force(simulation)` and set</span>
<span class="sd">            per-atom parameters accordingly for all `bias_atom_indices`.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This method is typically triggered by OpenMM according to the schedule</span>
<span class="sd">          returned by `describeNextReport`. It defensively calls</span>
<span class="sd">          `_ensure_atom_symbols(simulation)` in case the reporter was invoked</span>
<span class="sd">          before `describeNextReport`.</span>
<span class="sd">        - If `self.check_stability` is True, the method first evaluates stability via</span>
<span class="sd">          `_is_stable(simulation)`:</span>
<span class="sd">            * If unstable (ΔT &gt; 50 K from target), the bias is removed for safety.</span>
<span class="sd">            * If stable and `self.is_biasing` is True, the bias is (re)applied and a</span>
<span class="sd">              post-bias check is scheduled in 100 steps.</span>
<span class="sd">        - If neither `self.check_stability` nor `self.is_biasing` is set, the method</span>
<span class="sd">          performs no action for the current step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">currentStep</span>

    <span class="c1"># Defensive fallback in case describeNextReport hasn&#39;t been called yet</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_atom_symbols</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_bias</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_atom_indices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">biased_force</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_bias</span><span class="p">():</span>
        <span class="n">biased_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gad_force</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_atom_indices</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">biased_force</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">biased_forces</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_stability</span><span class="p">:</span>
        <span class="n">is_stable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_stable</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_stable</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;31m[GADES | step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">] System is unstable: Removing bias until next cycle...</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">remove_bias</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_biasing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;32m[GADES | step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">] Updating bias forces...</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">apply_bias</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">100</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">biased_force</span><span class="o">.</span><span class="n">updateParametersInContext</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stability</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_biasing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_biasing</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;32m[GADES | step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">] Updating bias forces...</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">apply_bias</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">biased_force</span><span class="o">.</span><span class="n">updateParametersInContext</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_biasing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_postbias_check_step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># If neither flag is True, do nothing</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="GADES.getGADESBiasForce" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">getGADESBiasForce</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">getGADESBiasForce</span><span class="p">(</span><span class="n">n_particles</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a custom OpenMM force object for GADES biasing.</p>
<p>This function constructs an OpenMM <code>CustomExternalForce</code> that applies
per-particle forces in the form:</p>
<div class="arithmatex">\[F(x, y, z) = f_x * x + f_y * y + f_z * z\]</div>
<p>where <code>fx</code>, <code>fy</code>, and <code>fz</code> are per-particle parameters that can be updated
during a simulation. The force is assigned to group <code>1</code> so that it can be
easily separated from other forces in analysis or reporting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_particles</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of particles in the system. Each particle will be assigned
its own <code>(fx, fy, fz)</code> parameter set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="openmm.CustomExternalForce">CustomExternalForce</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>openmm.CustomExternalForce:
A <code>CustomExternalForce</code> object configured with per-particle force
parameters for GADES biasing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>n_particles</code> is negative.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">GADES</span><span class="w"> </span><span class="kn">import</span> <span class="n">getGADESBiasForce</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">force</span> <span class="o">=</span> <span class="n">GAD_force</span> <span class="o">=</span> <span class="n">getGADESBiasForce</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">GAD_force</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>GADES/gades.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getGADESBiasForce</span><span class="p">(</span><span class="n">n_particles</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomExternalForce</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a custom OpenMM force object for GADES biasing.</span>

<span class="sd">    This function constructs an OpenMM `CustomExternalForce` that applies</span>
<span class="sd">    per-particle forces in the form:</span>

<span class="sd">    $$F(x, y, z) = f_x * x + f_y * y + f_z * z$$</span>

<span class="sd">    where `fx`, `fy`, and `fz` are per-particle parameters that can be updated</span>
<span class="sd">    during a simulation. The force is assigned to group `1` so that it can be</span>
<span class="sd">    easily separated from other forces in analysis or reporting.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_particles (int):</span>
<span class="sd">            Number of particles in the system. Each particle will be assigned</span>
<span class="sd">            its own `(fx, fy, fz)` parameter set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        openmm.CustomExternalForce:</span>
<span class="sd">            A `CustomExternalForce` object configured with per-particle force</span>
<span class="sd">            parameters for GADES biasing.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `n_particles` is negative.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from GADES import getGADESBiasForce</span>
<span class="sd">        &gt;&gt;&gt; system = ...</span>
<span class="sd">        &gt;&gt;&gt; force = GAD_force = getGADESBiasForce(system.getNumParticles())</span>
<span class="sd">        &gt;&gt;&gt; system.addForce(GAD_force)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">force</span> <span class="o">=</span> <span class="n">CustomExternalForce</span><span class="p">(</span><span class="s2">&quot;fx*x+fy*y+fz*z&quot;</span><span class="p">)</span>
    <span class="n">force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s2">&quot;fx&quot;</span><span class="p">)</span>
    <span class="n">force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s2">&quot;fy&quot;</span><span class="p">)</span>
    <span class="n">force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s2">&quot;fz&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_particles</span><span class="p">):</span>
        <span class="n">force</span><span class="o">.</span><span class="n">addParticle</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">force</span><span class="o">.</span><span class="n">setForceGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">force</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>